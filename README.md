# Wedding Website with RSVP System

A Next.js wedding website with code-based access control for multiple locations (Lagos, London, Portugal), integrated with Airtable for guest management and RSVP tracking.

## Features

- **Code-based Access Control**: Unique 8-character codes for personalized guest experiences
- **Multi-location Support**: Different content for Lagos, London, and Portugal
- **RSVP System**: Location-specific RSVP forms with dietary restrictions and visa requirements
- **Admin Dashboard**: Manage guests, generate codes, view RSVPs, and export data
- **Secure Code Generation**: Using nanoid for cryptographically secure random codes
- **Rate Limiting**: Protection against brute force code guessing attacks

## Setup Instructions

### 1. Install Dependencies

```bash
npm install
```

### 2. Configure Airtable

1. Create an Airtable base with two tables:

   - **Guests Table**: Fields (field names must match exactly):

     - `name` (Single line text) - Primary field, **Required**
     - `invite_code` (Single line text) - Optional, generated by admin
     - `email` (Email) - Optional
     - `allowed_locations` (Multiple select field) - **Required**: Options must be exactly "Lagos", "London", "Portugal"
     - `code_generated_at` (Date) - Optional, auto-filled when code is generated
     - `unique_link` (Formula field): `CONCATENATE("https://yourdomain.com?code=", invite_code)` - Optional, auto-calculated

     **Important**: Field names are case-sensitive and must match exactly as shown above.

   - **RSVPs Table**: Fields (field names must match exactly):

     - `invite_code` (Single line text) - Optional, for guests with codes
     - `location` (Single select field) - **Required**: Options must be exactly "Lagos", "London", "Portugal"
     - `name` (Single line text) - **Required**
     - `guests` (Number) - **Required**
     - `attending` (Checkbox) - **Required**
     - `dietary_restrictions` (Long text) - Optional
     - `visa_required` (Checkbox) - Optional
     - `accommodation_needed` (Checkbox) - Optional
     - `submitted_at` (Date field) - Optional, auto-filled by the app. If you include this field, it should be a Date field type (not Date & Time). The app will format it as YYYY-MM-DD. If you don't want to track submission dates, you can omit this field entirely.

     **Important**: Field names are case-sensitive and must match exactly as shown above.

2. Create a Personal Access Token:
   - Go to Airtable → Developer Hub → Personal Access Tokens
   - Create token with scopes: `data.records:read` and `data.records:write`
   - Select your base

### 3. Environment Variables

Create a `.env.local` file in the root directory:

```env
# Airtable Configuration
AIRTABLE_PERSONAL_ACCESS_TOKEN=your_personal_access_token_here
AIRTABLE_BASE_ID=your_base_id_here
AIRTABLE_GUESTS_TABLE=Guests
AIRTABLE_RSVPS_TABLE=RSVPs

# Site Configuration
NEXT_PUBLIC_SITE_URL=http://localhost:3000

# Admin Configuration
ADMIN_PASSWORD=your_secure_admin_password_here

# Rate Limiting (optional)
RATE_LIMIT_MAX_ATTEMPTS=10
RATE_LIMIT_WINDOW_MS=900000
```

### 4. Run Development Server

```bash
npm run dev
```

Open [http://localhost:3000](http://localhost:3000) in your browser.

## Usage

### Adding Guests

1. Add guest records in Airtable with name, email, and allowed locations
2. Visit `/admin` and log in with your admin password
3. Click "Generate Code" for each guest without a code
4. Copy the unique link and send it to the guest

### Guest Experience

- **Without Code**: Default Lagos information with simple RSVP (name only)
- **With Code**: Personalized content based on allowed locations with full RSVP forms

### Admin Dashboard

Access `/admin` to:

- View all guests and their unique links
- Generate codes for new guests
- View and filter RSVPs by location
- Export data to CSV

## Project Structure

```
/
├── app/
│   ├── page.tsx              # Main page with code-based routing
│   ├── admin/
│   │   └── page.tsx          # Admin dashboard
│   └── api/
│       ├── generate-code/    # Generate secure codes
│       ├── validate-code/    # Validate guest codes
│       ├── rsvp/             # Submit RSVPs
│       └── admin/            # Admin API endpoints
├── components/
│   ├── locations/            # Location-specific content
│   ├── Countdown.tsx         # Countdown timer
│   ├── RSVPForm.tsx          # RSVP form component
│   └── ...
├── lib/
│   ├── airtable.ts           # Airtable integration
│   ├── code-generation.ts    # Secure code generation
│   └── code-validation.ts   # Code validation with rate limiting
└── types/
    └── rsvp.ts               # TypeScript types
```

## Security Features

- **Secure Code Generation**: 8-character codes using nanoid with custom alphabet (2^30 combinations)
- **Rate Limiting**: Max 10 validation attempts per IP per 15 minutes
- **Server-Side Validation**: All code validation happens server-side
- **Admin Authentication**: Password-protected admin routes

## Customization

Update the following files to customize content:

- `components/locations/LagosContent.tsx` - Lagos wedding details
- `components/locations/LondonContent.tsx` - London wedding details
- `components/locations/PortugalContent.tsx` - Portugal wedding details
- Update wedding dates in each location component
- Add images to the `images` arrays in location components

## Deployment

1. Set environment variables in your hosting platform (Vercel/Netlify)
2. Update `NEXT_PUBLIC_SITE_URL` to your production domain
3. Deploy the application

## License

Private project for wedding use.
